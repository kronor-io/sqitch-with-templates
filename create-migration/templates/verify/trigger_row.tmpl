-- Verify [% project %]:[% change %] on [% engine %]

BEGIN;

    select 1 / count(*)
    from information_schema.triggers
    where trigger_name = '[% trigger_name %]'
        and event_object_schema = '[% schema %]'
        and event_object_table = '[% trigger_table %]';

    do $$
    declare
        err text;
    begin

        select string_agg(
          errors, '
          ') into err -- the string with a new line is on purpose

        from

        plpgsql_check_function(
          '[% schema %].trig_[% trigger_name %]()',
          '[% schema %].[% trigger_table %]',
          newtable := 'changed'
        ) errors;

        if err <> ''
        then
        raise exception '%', err;
        end if;

    end;
    $$;

ROLLBACK;
